<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: Hall Speed &amp; Position Feedback</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Hall Speed &amp; Position Feedback<div class="ingroups"><a class="el" href="group___m_c_s_d_k.html">MCSDK</a> &raquo; <a class="el" href="group___speedn_pos_fdbk.html">Speed &amp; Position Feedback</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Hall Sensor based Speed &amp; Position Feedback implementation.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:hall__speed__pos__fdbk_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hall__speed__pos__fdbk_8h.html">hall_speed_pos_fdbk.h</a></td></tr>
<tr class="memdesc:hall__speed__pos__fdbk_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">This file contains all definitions and functions prototypes for the Hall Speed &amp; Position Feedback component of the Motor Control SDK. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:hall__speed__pos__fdbk_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hall__speed__pos__fdbk_8c.html">hall_speed_pos_fdbk.c</a></td></tr>
<tr class="memdesc:hall__speed__pos__fdbk_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This file provides firmware functions that implement the features of the Hall Speed &amp; Position Feedback component of the Motor Control SDK. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">HALL component parameters definition.  <a href="struct_h_a_l_l___handle__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafcfb477bbe603d9452acfda79498aa9d"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hall__speed__pos__fdbk.html#gafcfb477bbe603d9452acfda79498aa9d">HALL_TIMx_UP_IRQHandler</a> (void *pHandleVoid)</td></tr>
<tr class="memdesc:gafcfb477bbe603d9452acfda79498aa9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Example of private method of the class HALL to implement an MC IRQ function to be called when TIMx update event occurs.  <a href="group__hall__speed__pos__fdbk.html#gafcfb477bbe603d9452acfda79498aa9d">More...</a><br /></td></tr>
<tr class="separator:gafcfb477bbe603d9452acfda79498aa9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga13d09d8795011d8b339bba023c9a4678"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hall__speed__pos__fdbk.html#ga13d09d8795011d8b339bba023c9a4678">HALL_TIMx_CC_IRQHandler</a> (void *pHandleVoid)</td></tr>
<tr class="memdesc:ga13d09d8795011d8b339bba023c9a4678"><td class="mdescLeft">&#160;</td><td class="mdescRight">Example of private method of the class HALL to implement an MC IRQ function to be called when TIMx capture event occurs.  <a href="group__hall__speed__pos__fdbk.html#ga13d09d8795011d8b339bba023c9a4678">More...</a><br /></td></tr>
<tr class="separator:ga13d09d8795011d8b339bba023c9a4678"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga21c7ba2ba2b2771d206b7596ddf6fdd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hall__speed__pos__fdbk.html#ga21c7ba2ba2b2771d206b7596ddf6fdd8">HALL_Init</a> (<a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *pHandle)</td></tr>
<tr class="memdesc:ga21c7ba2ba2b2771d206b7596ddf6fdd8"><td class="mdescLeft">&#160;</td><td class="mdescRight">It initializes the hardware peripherals (TIMx, GPIO and NVIC) required for the speed position sensor management using HALL sensors.  <a href="group__hall__speed__pos__fdbk.html#ga21c7ba2ba2b2771d206b7596ddf6fdd8">More...</a><br /></td></tr>
<tr class="separator:ga21c7ba2ba2b2771d206b7596ddf6fdd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab17bd47f5782ab156299adabb5befb1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hall__speed__pos__fdbk.html#gab17bd47f5782ab156299adabb5befb1a">HALL_Clear</a> (<a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *pHandle)</td></tr>
<tr class="memdesc:gab17bd47f5782ab156299adabb5befb1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear software FIFO where are "pushed" latest speed information This function must be called before starting the motor to initialize the speed measurement process.  <a href="group__hall__speed__pos__fdbk.html#gab17bd47f5782ab156299adabb5befb1a">More...</a><br /></td></tr>
<tr class="separator:gab17bd47f5782ab156299adabb5befb1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac3a147b3f58e5b5bbbde9b2613153f87"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hall__speed__pos__fdbk.html#gac3a147b3f58e5b5bbbde9b2613153f87">HALL_CalcElAngle</a> (<a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *pHandle)</td></tr>
<tr class="memdesc:gac3a147b3f58e5b5bbbde9b2613153f87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the rotor electrical angle integrating the last measured instantaneous electrical speed express in dpp.  <a href="group__hall__speed__pos__fdbk.html#gac3a147b3f58e5b5bbbde9b2613153f87">More...</a><br /></td></tr>
<tr class="separator:gac3a147b3f58e5b5bbbde9b2613153f87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gada8d69699b57d95c55f8b1d5a67dc2e6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hall__speed__pos__fdbk.html#gada8d69699b57d95c55f8b1d5a67dc2e6">HALL_CalcAvrgMecSpeedUnit</a> (<a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *pHandle, int16_t *hMecSpeedUnit)</td></tr>
<tr class="memdesc:gada8d69699b57d95c55f8b1d5a67dc2e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method must be called - at least - with the same periodicity on which speed control is executed. This method compute and store rotor istantaneous el speed (express in dpp considering the measurement frequency) in order to provide it to HALL_CalcElAngle function and SPD_GetElAngle. Then compute rotor average el speed (express in dpp considering the measurement frequency) based on the buffer filled by IRQ, then - as a consequence - compute, store and return - through parameter hMecSpeedUnit - the rotor average mech speed, expressed in Unit. Then check, store and return the reliability state of the sensor; in this function the reliability is measured with reference to specific parameters of the derived sensor (HALL) through internal variables managed by IRQ.  <a href="group__hall__speed__pos__fdbk.html#gada8d69699b57d95c55f8b1d5a67dc2e6">More...</a><br /></td></tr>
<tr class="separator:gada8d69699b57d95c55f8b1d5a67dc2e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Hall Sensor based Speed &amp; Position Feedback implementation. </p>
<p >This component is used in applications controlling a motor equipped with Hall effect sensors.</p>
<p >This component uses the output of two Hall effects sensors to provide a measure of the speed and the position of the rotor of the motor.</p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gada8d69699b57d95c55f8b1d5a67dc2e6" name="gada8d69699b57d95c55f8b1d5a67dc2e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gada8d69699b57d95c55f8b1d5a67dc2e6">&#9670;&#160;</a></span>HALL_CalcAvrgMecSpeedUnit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak bool HALL_CalcAvrgMecSpeedUnit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>hMecSpeedUnit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method must be called - at least - with the same periodicity on which speed control is executed. This method compute and store rotor istantaneous el speed (express in dpp considering the measurement frequency) in order to provide it to HALL_CalcElAngle function and SPD_GetElAngle. Then compute rotor average el speed (express in dpp considering the measurement frequency) based on the buffer filled by IRQ, then - as a consequence - compute, store and return - through parameter hMecSpeedUnit - the rotor average mech speed, expressed in Unit. Then check, store and return the reliability state of the sensor; in this function the reliability is measured with reference to specific parameters of the derived sensor (HALL) through internal variables managed by IRQ. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>handler of the current instance of the hall_speed_pos_fdbk component </td></tr>
    <tr><td class="paramname">hMecSpeedUnit</td><td>pointer to int16_t, used to return the rotor average mechanical speed (expressed in the unit defined by <a class="el" href="mc__stm__types_8h.html#a068140274b96a55eabb3ed3261c30d75" title="Rotation speed unit used at the interface with the application.">SPEED_UNIT</a>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>= sensor information is reliable false = sensor information is not reliable </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gac3a147b3f58e5b5bbbde9b2613153f87" name="gac3a147b3f58e5b5bbbde9b2613153f87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac3a147b3f58e5b5bbbde9b2613153f87">&#9670;&#160;</a></span>HALL_CalcElAngle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak int16_t HALL_CalcElAngle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the rotor electrical angle integrating the last measured instantaneous electrical speed express in dpp. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>handler of the current instance of the hall_speed_pos_fdbk component </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int16_t</td><td>Measured electrical angle in s16degree format. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gab17bd47f5782ab156299adabb5befb1a" name="gab17bd47f5782ab156299adabb5befb1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab17bd47f5782ab156299adabb5befb1a">&#9670;&#160;</a></span>HALL_Clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak void HALL_Clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear software FIFO where are "pushed" latest speed information This function must be called before starting the motor to initialize the speed measurement process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>handler of the current instance of the hall_speed_pos_fdbk component* </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga21c7ba2ba2b2771d206b7596ddf6fdd8" name="ga21c7ba2ba2b2771d206b7596ddf6fdd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga21c7ba2ba2b2771d206b7596ddf6fdd8">&#9670;&#160;</a></span>HALL_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak void HALL_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_h_a_l_l___handle__t.html">HALL_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>It initializes the hardware peripherals (TIMx, GPIO and NVIC) required for the speed position sensor management using HALL sensors. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>handler of the current instance of the hall_speed_pos_fdbk component </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga13d09d8795011d8b339bba023c9a4678" name="ga13d09d8795011d8b339bba023c9a4678"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga13d09d8795011d8b339bba023c9a4678">&#9670;&#160;</a></span>HALL_TIMx_CC_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak void * HALL_TIMx_CC_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pHandleVoid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Example of private method of the class HALL to implement an MC IRQ function to be called when TIMx capture event occurs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>handler of the current instance of the hall_speed_pos_fdbk component </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gafcfb477bbe603d9452acfda79498aa9d" name="gafcfb477bbe603d9452acfda79498aa9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafcfb477bbe603d9452acfda79498aa9d">&#9670;&#160;</a></span>HALL_TIMx_UP_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak void * HALL_TIMx_UP_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pHandleVoid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Example of private method of the class HALL to implement an MC IRQ function to be called when TIMx update event occurs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>handler of the current instance of the hall_speed_pos_fdbk component </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
