<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: Motor Control Tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Related components</a> &#124;
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Motor Control Tasks<div class="ingroups"><a class="el" href="group___m_c_s_d_k.html">MCSDK</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Motor Control subsystem configuration and operation routines. <br  />
  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Related components</h2></td></tr>
<tr class="memitem:group___m_c_app_hooks"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_app_hooks.html">Motor Control Applicative hooks</a></td></tr>
<tr class="memdesc:group___m_c_app_hooks"><td class="mdescLeft">&#160;</td><td class="mdescRight">User defined functions that are called in the Motor Control tasks. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:mc__tasks_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mc__tasks_8h.html">mc_tasks.h</a></td></tr>
<tr class="memdesc:mc__tasks_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">This file implementes tasks definition. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafc5efb2c13a7f84132cad2eea33744cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_tasks.html#gafc5efb2c13a7f84132cad2eea33744cc">MC_RunMotorControlTasks</a> (void)</td></tr>
<tr class="memdesc:gafc5efb2c13a7f84132cad2eea33744cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs all the Tasks of the Motor Control cockpit.  <a href="group___m_c_tasks.html#gafc5efb2c13a7f84132cad2eea33744cc">More...</a><br /></td></tr>
<tr class="separator:gafc5efb2c13a7f84132cad2eea33744cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5bfb7d24f2ad1246a4fa06c024f96957"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_tasks.html#ga5bfb7d24f2ad1246a4fa06c024f96957">MC_Scheduler</a> (void)</td></tr>
<tr class="memdesc:ga5bfb7d24f2ad1246a4fa06c024f96957"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes the Medium Frequency Task functions for each drive instance.  <a href="group___m_c_tasks.html#ga5bfb7d24f2ad1246a4fa06c024f96957">More...</a><br /></td></tr>
<tr class="separator:ga5bfb7d24f2ad1246a4fa06c024f96957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga70dcc80ce2a677f112e8e19b15ec9c5a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_tasks.html#ga70dcc80ce2a677f112e8e19b15ec9c5a">TSK_SafetyTask</a> (void)</td></tr>
<tr class="memdesc:ga70dcc80ce2a677f112e8e19b15ec9c5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes safety checks (e.g. bus voltage and temperature) for all drive instances.  <a href="group___m_c_tasks.html#ga70dcc80ce2a677f112e8e19b15ec9c5a">More...</a><br /></td></tr>
<tr class="separator:ga70dcc80ce2a677f112e8e19b15ec9c5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8c1ddefd0981ca101cfa98acb72aacc4"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_tasks.html#ga8c1ddefd0981ca101cfa98acb72aacc4">TSK_HighFrequencyTask</a> (void)</td></tr>
<tr class="memdesc:ga8c1ddefd0981ca101cfa98acb72aacc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Motor control profiler HF task.  <a href="group___m_c_tasks.html#ga8c1ddefd0981ca101cfa98acb72aacc4">More...</a><br /></td></tr>
<tr class="separator:ga8c1ddefd0981ca101cfa98acb72aacc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0beda6e1849093d2bbb0bb08b34fa737"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_tasks.html#ga0beda6e1849093d2bbb0bb08b34fa737">TSK_DualDriveFIFOUpdate</a> (uint8_t Motor)</td></tr>
<tr class="memdesc:ga0beda6e1849093d2bbb0bb08b34fa737"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserves FOC execution on ADC ISR half a PWM period in advance.  <a href="group___m_c_tasks.html#ga0beda6e1849093d2bbb0bb08b34fa737">More...</a><br /></td></tr>
<tr class="separator:ga0beda6e1849093d2bbb0bb08b34fa737"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae1fdad1bcdfa2ba677a20235f893ca5c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_tasks.html#gae1fdad1bcdfa2ba677a20235f893ca5c">TSK_HardwareFaultTask</a> (void)</td></tr>
<tr class="memdesc:gae1fdad1bcdfa2ba677a20235f893ca5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Puts the Motor Control subsystem in in safety conditions on a Hard Fault.  <a href="group___m_c_tasks.html#gae1fdad1bcdfa2ba677a20235f893ca5c">More...</a><br /></td></tr>
<tr class="separator:gae1fdad1bcdfa2ba677a20235f893ca5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55b0971a2d52bbf9328598320b1bd4ba"><td class="memItemLeft" align="right" valign="top"><a id="ga55b0971a2d52bbf9328598320b1bd4ba" name="ga55b0971a2d52bbf9328598320b1bd4ba"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>mc_lock_pins</b> (void)</td></tr>
<tr class="memdesc:ga55b0971a2d52bbf9328598320b1bd4ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locks GPIO pins used for Motor Control to prevent accidental reconfiguration. <br /></td></tr>
<tr class="separator:ga55b0971a2d52bbf9328598320b1bd4ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Motor Control subsystem configuration and operation routines. <br  />
 </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gafc5efb2c13a7f84132cad2eea33744cc" name="gafc5efb2c13a7f84132cad2eea33744cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafc5efb2c13a7f84132cad2eea33744cc">&#9670;&#160;</a></span>MC_RunMotorControlTasks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MC_RunMotorControlTasks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs all the Tasks of the Motor Control cockpit. </p>
<p >This function is to be called periodically at least at the Medium Frequency task rate (It is typically called on the Systick interrupt). Exact invokation rate is the Speed regulator execution rate set in the Motor Contorl Workbench.</p>
<p >The following tasks are executed in this order:</p>
<ul>
<li>Medium Frequency Tasks of each motors</li>
<li>Safety Task</li>
<li>Power Factor Correction Task (if enabled)</li>
<li>User Interface task. </li>
</ul>

</div>
</div>
<a id="ga5bfb7d24f2ad1246a4fa06c024f96957" name="ga5bfb7d24f2ad1246a4fa06c024f96957"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5bfb7d24f2ad1246a4fa06c024f96957">&#9670;&#160;</a></span>MC_Scheduler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MC_Scheduler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes the Medium Frequency Task functions for each drive instance. </p>
<p >It is to be clocked at the Systick frequency. </p>

</div>
</div>
<a id="ga0beda6e1849093d2bbb0bb08b34fa737" name="ga0beda6e1849093d2bbb0bb08b34fa737"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0beda6e1849093d2bbb0bb08b34fa737">&#9670;&#160;</a></span>TSK_DualDriveFIFOUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSK_DualDriveFIFOUpdate </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>Motor</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserves FOC execution on ADC ISR half a PWM period in advance. </p>
<p >This function is called by TIMx_UP_IRQHandler in case of dual MC and it allows to reserve half PWM period in advance the FOC execution on ADC ISR </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pDrive</td><td>Pointer on the FOC Array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gae1fdad1bcdfa2ba677a20235f893ca5c" name="gae1fdad1bcdfa2ba677a20235f893ca5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae1fdad1bcdfa2ba677a20235f893ca5c">&#9670;&#160;</a></span>TSK_HardwareFaultTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSK_HardwareFaultTask </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Puts the Motor Control subsystem in in safety conditions on a Hard Fault. </p>
<p >This function is to be executed when a general hardware failure has been detected <br  />
 by the microcontroller and is used to put the system in safety condition. </p>

</div>
</div>
<a id="ga8c1ddefd0981ca101cfa98acb72aacc4" name="ga8c1ddefd0981ca101cfa98acb72aacc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8c1ddefd0981ca101cfa98acb72aacc4">&#9670;&#160;</a></span>TSK_HighFrequencyTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__weak uint8_t TSK_HighFrequencyTask </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Motor control profiler HF task. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">uint8_t</td><td>It return always 0.</td></tr>
  </table>
  </dd>
</dl>
<p>Motor control profiler HF task.</p>
<p >This is mainly the FOC current control loop. It is executed depending on the state of the Motor Control subsystem (see the state machine(s)).</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Number</td><td>of the motor instance which FOC loop was executed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">uint8_t</td><td>It return always 0. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga70dcc80ce2a677f112e8e19b15ec9c5a" name="ga70dcc80ce2a677f112e8e19b15ec9c5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga70dcc80ce2a677f112e8e19b15ec9c5a">&#9670;&#160;</a></span>TSK_SafetyTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TSK_SafetyTask </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes safety checks (e.g. bus voltage and temperature) for all drive instances. </p>
<p >Faults flags are updated here. </p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
