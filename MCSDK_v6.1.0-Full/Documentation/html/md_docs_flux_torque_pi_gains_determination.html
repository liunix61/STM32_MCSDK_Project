<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: A priori determination of flux and torque current PI gains</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">A priori determination of flux and torque current PI gains </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This section provides a criterion for the computation of the initial values of the torque &amp; flux PI parameters ( \(K_i\) and \(K_p\)). This criterion is also used by the ST MC Workbench in its computation.</p>
<p >To calculate these starting values, it is required to know the electrical characteristics of the motor (stator resistance \(R_s\) and inductance \(L_s\)) and the electrical characteristics of the hardware (shunt resistor \(R_{Shunt}\), current sense amplification network \(A_{op}\) and the direct current bus voltage \(V_{BusDC}\)).</p>
<p >The derivative action of the controller is not considered using this method.</p>
<p >The figure below shows the PI controller block diagram used for torque or flux regulation.</p>
<div class="image">
<img src="pi_regulator_block_diag.png" alt=""/>
<div class="caption">
Block diagram of PI controller</div></div>
    <p >For this analysis, the motor electrical characteristics are assumed to be isotropic with respect to the q and d axes. It is assumed that the torque and flux regulators have the same starting value of \(K_p\) and the same \(K_i\) value.</p>
<p >The next figure shows the closed loop system in which the motor phase is modelled using the resistor-inductance equivalent circuit in the “locked-rotor” condition.</p>
<p >Block “A” is the proportionality constant between the software variable storing the voltage command (expressed in digit) and the real voltage applied to the motor phase (expressed in Volt). Likewise, block “B” is the the proportionality constant between the real current (expressed in Ampere) and the software variable storing the phase current (expressed in digit).</p>
<div class="image">
<img src="pid_closed_loop.png" alt=""/>
<div class="caption">
Closed loop block diagram</div></div>
    <p >The transfer functions of the two blocks “A” and “B” are expressed as:</p>
<p >$$ A=\frac{V_{BusDC}}{2^{16}} $$</p>
<p >and</p>
<p >$$ B=\frac{R_{Shunt}A_{op}2^{16}}{3.3} $$</p>
<p >By inserting \(\frac{K_p}{K_i} = \frac{L_s}{R_s}\), it is possible to perform pole-zero cancellation shown below.</p>
<div class="image">
<img src="pid_pole_zero_cancellation.png" alt=""/>
<div class="caption">
Pole-zero cancellation</div></div>
    <p >In this condition, the closed loop system is brought back to a first-order system and the dynamics of the system can be assigned using a proper value of \(K_i\):</p>
<div class="image">
<img src="pid_closed_loop_zero_cancelled.png" alt=""/>
<div class="caption">
Block diagram of closed loop system after pole-zero cancellation</div></div>
    <p ><b>Note:</b> The parameters used in the PI algorithms must be integers; so the calculated \(K_i\) and \(K_p\) values must be expressed as fractions (dividend/divisor):</p>
<p >$$ K_{p} = \frac{K_{pg}}{K_{pd}} $$ $$ K_{i} = \frac{K_{ig}}{K_{id}} $$</p>
<p >Moreover, the PI algorithm does not include the PI sampling time ( \(T\)) in the computation of the integral component. Referring to the following formula:</p>
<p >$$ k_i\int_{0}^{t}e\left(\tau\right)d\tau=k_iT\sum_{k=1}^{n}{e(kT)}=K_i\sum_{k=1}^{n}{e(kT)} $$</p>
<p >since the integral part of the controller is computed as a sum of successive errors, it is required to include \(T\) in the calculation of \(K_i\).</p>
<p >The final formula can then be expressed as:</p>
<p >$$ K_{pg}=L_s\frac{\omega_c}{AB}K_pd $$</p>
<p >$$ K_{ig}=\frac{R_s\cdot\omega_c\cdot K_{id}}{AB}\cdot T $$</p>
<p >$$ AB=\frac{V_{BusDC}\cdot R_{Shunt}\cdot A_{op}}{3.3} $$</p>
<p >Usually, it is possible to set \(ω_c\) (the bandwidth of the closed loop system) to 1500 rad/s, to obtain a good trade-off between dynamic response and sensitivity to the measurement noise.</p>
<p ><a class="el" href="md_docs_space_vector__p_w_m_implementation.html">Next: Space vector PWM implementation</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
