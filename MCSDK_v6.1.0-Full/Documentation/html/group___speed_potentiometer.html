<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: Speed Potentiometer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Speed Potentiometer<div class="ingroups"><a class="el" href="group___m_c_s_d_k.html">MCSDK</a> &raquo; <a class="el" href="group___potentiometer.html">Linear Potentiometer</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Potentiometer reading component that sets the motor speed reference from the potentiometer value.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:speed__potentiometer_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="speed__potentiometer_8h.html">speed_potentiometer.h</a></td></tr>
<tr class="memdesc:speed__potentiometer_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">This file contains the definitions and functions prototypes for the Speed Potentiometer component of the Motor Control SDK. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:speed__potentiometer_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="speed__potentiometer_8c.html">speed_potentiometer.c</a></td></tr>
<tr class="memdesc:speed__potentiometer_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This file provides firmware functions that implement the features of the Speed Potentiometer component of the Motor Control SDK. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle structure of a Speed Potentiometer component.  <a href="struct_speed_potentiometer___handle__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1cbb76ee045c8cd9a4e13800c7e81ff8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___speed_potentiometer.html#ga1cbb76ee045c8cd9a4e13800c7e81ff8">SPDPOT_Init</a> (<a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a> *pHandle)</td></tr>
<tr class="memdesc:ga1cbb76ee045c8cd9a4e13800c7e81ff8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a Speed Potentiometer component.  <a href="group___speed_potentiometer.html#ga1cbb76ee045c8cd9a4e13800c7e81ff8">More...</a><br /></td></tr>
<tr class="separator:ga1cbb76ee045c8cd9a4e13800c7e81ff8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2db19578a2067b791aa7ab7c167e8650"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___speed_potentiometer.html#ga2db19578a2067b791aa7ab7c167e8650">SPDPOT_Clear</a> (<a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a> *pHandle)</td></tr>
<tr class="memdesc:ga2db19578a2067b791aa7ab7c167e8650"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears the state of a Speed Potentiometer component.  <a href="group___speed_potentiometer.html#ga2db19578a2067b791aa7ab7c167e8650">More...</a><br /></td></tr>
<tr class="separator:ga2db19578a2067b791aa7ab7c167e8650"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaad29e9e331013b845c47088f370122de"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___speed_potentiometer.html#gaad29e9e331013b845c47088f370122de">SPDPOT_Run</a> (<a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a> *pHandle)</td></tr>
<tr class="memdesc:gaad29e9e331013b845c47088f370122de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the value of the potentiometer of a Speed Potentiometer component and sets the rotation speed reference of the motor it targets acordingly.  <a href="group___speed_potentiometer.html#gaad29e9e331013b845c47088f370122de">More...</a><br /></td></tr>
<tr class="separator:gaad29e9e331013b845c47088f370122de"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Potentiometer reading component that sets the motor speed reference from the potentiometer value. </p>
<p >The Speed Potentiometer component uses the services of the <a class="el" href="group___potentiometer.html">Linear Potentiometer</a> component to read a potentiometer. Values read from this potentiometer are used to set the rotation speed reference of a motor.</p>
<p >The state of a Speed Potentiometer component is maintained in a <a class="el" href="struct_speed_potentiometer___handle__t.html" title="Handle structure of a Speed Potentiometer component.">SpeedPotentiometer_Handle_t</a> structure. To use the Speed Potentiometer component, a <a class="el" href="struct_speed_potentiometer___handle__t.html" title="Handle structure of a Speed Potentiometer component.">SpeedPotentiometer_Handle_t</a> structure needs to be instanciated and initialized. The initialization is performed thanks to the <a class="el" href="group___speed_potentiometer.html#ga1cbb76ee045c8cd9a4e13800c7e81ff8" title="Initializes a Speed Potentiometer component.">SPDPOT_Init()</a> function. Prior to calling this function, some of the fields of this structure need to be given a value. See the <a class="el" href="struct_potentiometer___handle__t.html" title="Handle structure of a Potentiometer component.">Potentiometer_Handle_t</a> and below for more details on this.</p>
<p >A Speed Potentiometer component sets speed references by executing speed ramps thanks to the <a class="el" href="group___speedn_torq_ctrl.html#ga01246d9961f11dc3a7ea9b128b6256dc" title="Starts the execution of a ramp using new target and duration.">STC_ExecRamp()</a> function. Prior to doing so, the component checks if the motor is started (that is: if its state machine has reached the <a class="el" href="group___m_c_interface.html#ggaf9c63cc62b4961a5e4ae805cac0abf0ca439c688a4e9ed31638d5922a50680a8e">RUN</a> state) and if its control modality is <a class="el" href="group___m_c___type.html#gga93791db1e1974fe42cab1e0a9c35e21ead12dd58db95f8ccfe87c62faeff4b59c">Speed</a>. If either of these conditions is not met, no speed ramp is executed.</p>
<p >In addition, a speed ramp is executed only if the value of the potentiometer at that time differs from the one of the previous ramp that the component filed by a configurable amount. This amount is gieven by the <a class="el" href="struct_speed_potentiometer___handle__t.html#a67be4cb26502b79fce98ca10fa61024d">SpeedAdjustmentRange</a> field of the Handle structure.</p>
<p >The speed range accessible through the potentiometer is bounded by a minimum speed and a maximum speed. the minimum speed is stated at compile time in the <a class="el" href="struct_speed_potentiometer___handle__t.html#a696b50f4247aba1c9bd30dc8b62c9271">MinimumSpeed</a> field of the Handle structure. The maximum speed is deduced from the <a class="el" href="struct_speed_potentiometer___handle__t.html#a3043b9d5dfe42c02a735f019de4b523b">ConversionFactor</a> field thanks to the following formula:</p>
<p >$$ MaximumSpeed = \frac{(65536 - MinimumSpeed \times ConversionFactor )}{ConversionFactor} $$</p>
<p >where 65536 is the maximum value that the potentiometer (the ADC actually) can produce.</p>
<p >The <a class="el" href="struct_speed_potentiometer___handle__t.html#a696b50f4247aba1c9bd30dc8b62c9271">MinimumSpeed</a> can be set so that when the potentiometer is set to its minimum value, the motor stil spins. This is useful when the Motor Control application uses a sensorless speed and position sensing algorithm that cannot work below a given speed.</p>
<p >The duration of speed ramps is controlled with the <a class="el" href="struct_speed_potentiometer___handle__t.html#aef68a2f5e4c5f1fe7e68e24a8c1ede9a">RampSlope</a> field of the Handle. This field actually sets the acceleration used to change from one speed to another.</p>
<p >A potentiometer provides absolute values. A Speed Potentiometer component turns these values into either positive or negative speed references depending on the actual speed of the motor. So, if a motor is started with a negative speed, the references set by the Speed Potentiometer component targetting it will also be negative.</p>
<p >Values measured from the potentiometer are expressed in "u16digits": these are 16-bit values directly read from an ADC. They need to be converted to the <a class="el" href="mc__stm__types_8h.html#a068140274b96a55eabb3ed3261c30d75">speed unit</a> used by the API of the motor control library in order to generatethe speed references for the ramps.</p>
<dl class="section note"><dt>Note</dt><dd>In the current version of the Speed Potentiometer component, the periodic ADC measures <b>must</b> be performed on the Medium Frequency Task. This can be done by using the <a class="el" href="group___m_c_app_hooks.html#ga2213fc33469185c3e32c91c025ea0390" title="Hook function called right after the Medium Frequency Task.">MC_APP_PostMediumFrequencyHook_M1()</a> function of the <a class="el" href="group___m_c_app_hooks.html">Motor Control Applicative hooks</a> service for instance. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga2db19578a2067b791aa7ab7c167e8650" name="ga2db19578a2067b791aa7ab7c167e8650"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2db19578a2067b791aa7ab7c167e8650">&#9670;&#160;</a></span>SPDPOT_Clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SPDPOT_Clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clears the state of a Speed Potentiometer component. </p>
<p >The state of the <a class="el" href="group___potentiometer.html">Linear Potentiometer</a> component instance used by the Speed Potentiometer component is also cleared.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>Handle on the Speed Potentiometer component </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga1cbb76ee045c8cd9a4e13800c7e81ff8" name="ga1cbb76ee045c8cd9a4e13800c7e81ff8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1cbb76ee045c8cd9a4e13800c7e81ff8">&#9670;&#160;</a></span>SPDPOT_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SPDPOT_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a Speed Potentiometer component. </p>
<p >This function must be called once before the component can be used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>Handle on the Speed Potentiometer component to initialize </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gaad29e9e331013b845c47088f370122de" name="gaad29e9e331013b845c47088f370122de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaad29e9e331013b845c47088f370122de">&#9670;&#160;</a></span>SPDPOT_Run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SPDPOT_Run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_speed_potentiometer___handle__t.html">SpeedPotentiometer_Handle_t</a> *&#160;</td>
          <td class="paramname"><em>pHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the value of the potentiometer of a Speed Potentiometer component and sets the rotation speed reference of the motor it targets acordingly. </p>
<p >The potentiometer handled by the Speed Potentiometer component is read. If its value differs from the one that was last used to set the speed reference of the motor by more than <a class="el" href="struct_speed_potentiometer___handle__t.html#a67be4cb26502b79fce98ca10fa61024d">SpeedAdjustmentRange</a>, then this new value is used to set a new speed reference.</p>
<p >If the motor does not spin (it is not in the <a class="el" href="group___m_c_interface.html#ggaf9c63cc62b4961a5e4ae805cac0abf0ca439c688a4e9ed31638d5922a50680a8e">RUN</a> state) or if the current motor control modality is not speed (<a class="el" href="group___m_c___type.html#gga93791db1e1974fe42cab1e0a9c35e21ead12dd58db95f8ccfe87c62faeff4b59c" title="Closed loop, Speed mode.">MCM_SPEED_MODE</a>), nothing is done.</p>
<p >This function needs to be called periodically. See the <a class="el" href="group___potentiometer.html">Linear Potentiometer</a> documentation for more details.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandle</td><td>Handle on the Speed Potentiometer component </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
