<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: PMSM maximum torque per ampere (MTPA) control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PMSM maximum torque per ampere (MTPA) control </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The electromagnetic torque equation of an IPMSM is:</p>
<p >$$T_e=\frac{3}{2}\bar{p}\left(\lambda_{ds}{\ i}_{qs}-\lambda_{qs}{\ i}_{ds}\right)=\frac{3}{2}\bar{p}\left(L_{ds}\ i_{ds}\ i_{qs}+\phi_m\ i_{qs}-L_{qs}\ i_{qs}\ i_{ds}\right)$$</p>
<p >$$T_e=\frac{3}{2}\bar{p}\phi_m\ i_{qs}+\frac{3}{2}\bar{p}(L_{ds}-L_{qs})i_{qs}\ i_{ds}$$</p>
<p >The first term in this expression is the PM excitation torque. The second term is the so-called reluctance torque, which represents an additional component due to the intrinsic salient magnetic structure. Besides, since \(L_d &lt; L_q\) typically, reluctance and excitation torques have the same direction only if \(i_{ds} &lt; 0\).</p>
<p >Considering the torque equation, it can be pointed out that the current components \(i_{qs}\) and \(i_{ds}\) both have a direct influence on the torque generation.</p>
<p >The aim of the MTPA (maximum-torque-per-ampere) control is to calculate the reference currents \((i_{qs}, $i_{ds})\) which maximize the ratio between produced electromagnetic torque and copper losses (under the following condition).</p>
<p >$$I_s=\sqrt{i_{qs}^2+i_{ds}^2}\le I_s$$</p>
<p >Therefore, given a set of motor parameters (pole pairs, direct and quadrature inductances Ld and Lq, magnets flux linkage, nominal current), the MTPA trajectory is identified as the locus of \((i_{qs}, $i_{ds})\) pairs that minimizes the current consumption for each required torque (see figure below).</p>
<p >This feature can be activated with the ST MC Workbench GUI.</p>
<div class="image">
<img src="MTPA_trajectory.png" alt=""/>
<div class="caption">
MTPA trajectory</div></div>
    <p >The following figure shows the MTPA strategy implemented inside a speed-control loop. In this case, \(i_q^*\) (output of the PI regulator) is fed to the MTPA function, \(i_d^*\) is chosen by entering the linear interpolated trajectory.</p>
<div class="image">
<img src="MTPA_control.png" alt=""/>
<div class="caption">
MTPA control</div></div>
    <p >In all cases, by acting on the direct axis current ids, the magnetic flux can be weakened so as to extend the achievable speed range. As a consequence of entering this operating region, the MTPA path is left (see <a class="el" href="md_docs_flux_weakening_control.html">Flux-weakening control</a> for details about the flux-weakening strategy).</p>
<p >In conclusion, by regulating the motor currents through their iqs and ids components, FOC manages to regulate the PMSM torque and flux. Current regulation is then achieved by means of what is usually called a “synchronous frame CR-PWM”.</p>
<p ><a class="el" href="md_docs_feed_forward_current_regulation.html">Next: Feed Forward current regulation</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
