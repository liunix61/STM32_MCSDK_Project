<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: Quadrature Encoder sensor feedback processing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Quadrature Encoder sensor feedback processing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Quadrature incremental encoders are widely used to read the rotor position of electric machines.</p>
<p >As the name implies, incremental encoders actually read angular displacements with respect to an initial position: if that position is known, then the rotor absolute angle is known too. For this reason, it is always necessary, when processing the encoder feedback, to perform a rotor prepositioning before the first startup after any fault event or microcontroller reset.</p>
<p >Quadrature encoders have two output signals (represented in the following figure) as TI1 and TI2). Together with the standard timer in the encoder interface mode, once the said alignment procedure has been executed, it is possible to get information about the actual rotor angle - and therefore the rolling direction - by simply reading the counter of the timer used to decode encoder signals.</p>
<p >For the purpose of MC Library and as information provided by the MC API, the rotor angle is expressed in ‘s16degrees’ (see <a class="el" href="md_docs_measurement_units.html">Measurement units</a>).</p>
<div class="image">
<img src="qenc_counter_operation.png" alt=""/>
<div class="caption">
Encoder output signals: counter operation</div></div>
    <p >The rotor angular velocity can be easily calculated as a time derivative of the angular position.</p>
<h1>Setting up the system when using an encoder</h1>
<p >Extra care should be taken over what is considered to be the positive rolling direction: this software library assumes that the positive rolling direction is the rolling direction of a machine that is fed with a three-phase system of positive sequence.</p>
<p >Because of this, and because of how the encoder output signals are wired to the microcontroller input pins, it is possible to have a sign discrepancy between the real rolling direction and the direction that is read. To avoid this kind of reading error, apply the following procedure:</p>
<ol type="1">
<li>Turn the rotor by hand in the direction assumed to be positive and look at the B-emf induced on the three motor phases. A neutral point may need to be reconstructed with three resistors if the real one is not available.</li>
<li>Connect the motor phases to the hardware respecting the positive sequence (for instance when using the MB459 board, a positive sequence of the motor phases may be connected to J5 2,1 and 3).</li>
<li>Run the firmware in the encoder configuration and turn by hand the rotor in the direction assumed to be positive. If the measured speed shown on the LCD is positive, the connection is correct; otherwise, it can be corrected by simply swapping and rewiring the encoder output signals.</li>
</ol>
<p >If this is not practical, a software setting may be modified instead, using the ST MC Workbench GUI (see the GUI help file).</p>
<h2>Alignment settings</h2>
<p >The quadrature encoder is a relative position sensor. Considering that absolute information is required for performing field-oriented control, it is necessary to establish a 0° position. This task is performed by means of an alignment phase that is carried out on the first motor startup and optionally after any fault event. It consists of imposing a stator flux with a linearly increasing magnitude and a constant orientation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
