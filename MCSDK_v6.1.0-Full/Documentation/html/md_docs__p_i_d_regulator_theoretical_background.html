<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: PID regulator theoretical background</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PID regulator theoretical background </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Proportional-Integral-Derivative regulators</h1>
<p >The regulators implemented for Torque, Flux and Speed are actually Proportional Integral Derivative (PID) regulators. PID regulator theory and tuning methods are subjects which have been extensively discussed in technical literature. This section provides a basic reminder of the theory.</p>
<p >PID regulators are useful to maintain a level of torque, flux or speed according to a desired target. Indeed, both the torque and the flux are a function of the rotor position. FOC needs to regulate torque and flux to maximize system efficiency. In addition, the torque is also a function of the rotor speed. Hence, performing speed regulation results into regulating the torque.</p>
<p >The following equation is that of a general discrete PID regulator:</p>
<p >$$r\left(t_k\right)=K_p\cdot\varepsilon\left(t_k\right)+K_i\cdot\sum_{j=0}^{k}{\varepsilon\left(t_j\right)+}K_d\cdot\left(\varepsilon\left(t_k\right)-\varepsilon\left(t_{k-1}\right)\right)$$</p>
<p >where:</p>
<ul>
<li>\(ε(t_k)\) is the error of the system observed at time \(t = t_k\), while \(ε(t_{k − 1})\) is the error of the system at time \(t = t_k − T_{sampling}\)</li>
<li>\(K_p\) is the proportional coefficient.</li>
<li>\(K_i\) is the integral coefficient.</li>
<li>\(K_d\) is the differential coefficient.</li>
<li>\(r(t_k)\) is the reference to apply as output of the PID regulator</li>
</ul>
<p >In a motor control application, the derivative term can be disabled. This is indeed the case in the STM32 Motor Control SDK although both PID regulator implantations are provided.</p>
<h1>Regulator sampling time setting</h1>
<p >The sampling period \(T_{sampling}\) needs to be modified to adjust the regulation bandwidth. As an accumulative term (the integral term) is used in the algorithm, increasing the loop time decreases its effects (accumulation is slower and the integral action on the output is delayed). Inversely, decreasing the loop time increases its effects (accumulation is faster and the integral action on the output is increased). This is why this parameter has to be adjusted prior to setting up any coefficient of the PID regulator.</p>
<p >In order to keep the CPU load as low as possible and as induced from the PID discrete PID regulator equation above, the sampling time is directly part of the integral coefficient, thus avoiding an extra multiplication. The table below describes the link between the time domain and the discrete system.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Domain   </th><th class="markdownTableHeadNone">Equation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Time domain   </td><td class="markdownTableBodyNone">\(r\left(t\right)=K_p\cdot\varepsilon\left(t\right)+K_i\cdot\int_{0}^{t}\varepsilon\left(t\right)dt+K_d\cdot\frac{d}{dt}\varepsilon\left(t\right)\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Diescrete domain   </td><td class="markdownTableBodyNone">\(r\left(t_k\right)=K_p\cdot\varepsilon\left(t_k\right)+K_i\cdot\sum_{j=0}^{k}{\varepsilon\left(t_j\right)+}K_d\cdot\left(\varepsilon\left(t_k\right)-\varepsilon\left(t_{k-1}\right)\right)\)   </td></tr>
</table>
<p >In theory, the higher the sampling rate, the better the regulation. In practice, one must keep in mind that:</p>
<ul>
<li>The related CPU load will grow accordingly.</li>
<li>For speed regulation, there is absolutely no need to have a sampling time lower than the refresh rate of the speed information fed back by the external sensors; this becomes especially true when Hall sensors are used while driving the motor at low speed.</li>
</ul>
<p ><a class="el" href="md_docs_flux_torque_pi_gains_determination.html">Next: Flux and torque current PI gains determination</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
