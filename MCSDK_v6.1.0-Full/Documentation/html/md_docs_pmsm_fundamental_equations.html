<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Motor Control SDK: PMSM fundamental equations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    }
});
</script>
<script type="text/javascript" async="async" src="./mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styleSheetFile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="motor_control.png"/></td>
  <td id="projectalign">
   <div id="projectname">STM32 Motor Control SDK<span id="projectnumber">&#160;MCFW-6.1.0</span>
   </div>
   <div id="projectbrief">Software Development Kit to build applications driving PMSM Motors with STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PMSM fundamental equations </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>PMSM reference frame</h1>
<div class="image">
<object type="image/svg+xml" data="pmsm_reference_frame_convention.svg" style="pointer-events: none;"></object>
<div class="caption">
PMSM reference frame convention</div></div>
    <p >Refering to the figure above, the motor voltage and flux linkage equations of a PMSM (SM-PMSM or IPMSM) are generally expressed as:</p>
<p >$$V_{{abc}_s}=r_si_{{abc}_s}+\frac{d\lambda_{{abc}_s}}{dt}$$</p>
<p >$$\lambda_{{abc}_s}=\left[\begin{matrix}L_{ls}+L_{ms}&amp;-\frac{L_{ms}}{2}&amp;-\frac{L_{ms}}{2}\\-\frac{L_{ms}}{2}&amp;L_{ls}+L_{ms}&amp;-\frac{L_{ms}}{2}\\-\frac{L_{ms}}{2}&amp;-\frac{L_{ms}}{2}&amp;L_{ls}+L_{ms}\end{matrix}\right]+\left[\begin{matrix}\sin{\theta_r}\\\sin{\left(\theta_r-\frac{2\pi}{3}\right)}\\\sin{\left(\theta_r+\frac{2\pi}{3}\right)}\end{matrix}\right]\phi_m$$ where:</p>
<ul>
<li>\(r_s\) = stator phase winding resistance</li>
<li>\(L_{ls}\) = stator phase winding leakage inductance</li>
<li>\(L_{ms}\) = stator phase winding magnetizing inductance; in case of an IPMSM, self and mutual inductances have a secon harmonic component \(L_{2s}\) proportional to \(cos(2θr + k × 2π/3)\), with \(k = 0±1\), in addition to the constant component \(L_{ms}\) (neglecting higher-order harmonics)</li>
<li>\(θ_r\) = rotor electrical angle</li>
<li>\(Φ_m\) = flux linkage due to permanent magnets</li>
</ul>
<p >The complexity of these equations is apparent, as the three stator flux linkages are mutually coupled, and as they are dependent on the rotor position, which is time-varying and a function of the electromagnetic and load torques.</p>
<p >The reference frame theory simplifies the PM motor equations by changing a set of variables that refers the stator quantities abc (that can be visualized as directed along axes each 120° apart) to qd components, directed along a 90° apart axes, rotating synchronously with the rotor, and vice versa. The d “direct” axis is aligned with the rotor flux, while the q “quadrature” axis leads at 90 degrees in the positive rolling direction.</p>
<p >The motor voltage and flux equations are simplified to:</p>
<p >$$\left\{\begin{matrix}v_{qs}=r_s\ i_{qs}+\frac{d\lambda_{qs}}{dt}+\omega_r{\ \lambda}_{ds}\\v_{ds}=r_s{\ i}_{ds}+\frac{d\lambda_{ds}}{dt}-\omega_r{\ \lambda}_{qs}\end{matrix}\right.$$</p>
<p >$$\left\{\begin{matrix}\lambda_{qs}=L_{qs}\ i_{qs}\\\lambda_{ds}=L_{ds}\ i_{ds}+\phi_m\end{matrix}\right.$$</p>
<p >For an SM-PMSM, the inductances of the d- and q- axis circuits are the same (refer to <a class="el" href="md_docs_permanent_magnet_motors_structure.html">PM motor structures</a>), that is:</p>
<p >$$L_s=L_{qs}=L_{ds}=\frac{3}{2}L_{ms}$$</p>
<p >On the other hand, IPMSMs show a salient magnetic structure; thus, their inductances can be written as:</p>
<p >$$\left\{\begin{matrix}L_{qs}=L_{Is}+\frac{3}{2}(L_{ms}+L_{2s})\\L_{ds}=L_{Is}+\frac{3}{2}(L_{ms}-L_{2s})\\\end{matrix}\right.$$</p>
<h1>SM-PMSM field-oriented control (FOC)</h1>
<p >The equations below describe the electromagnetic torque of an SM-PMSM:</p>
<p >$$T_e=\frac{3}{2}\bar{p}\left(\lambda_{ds}{\ i}_{qs}-\lambda_{qs}{\ i}_{ds}\right)=\frac{3}{2}\bar{p}\left(L_s\ i_{ds}\ i_{qs}-L_s\ i_{qs}\ i_{ds}+\phi_m\ i_{qs}\right)$$</p>
<p >$$T_e=\frac{3}{2}\bar{p}\left(\phi_m\ i_{qs}\right)$$</p>
<p >The last equation makes it clear that the quadrature current component iqs has linear control on the torque generation, whereas the current component ids has no effect on it (as mentioned above, these equations are valid for SM-PMSMs).</p>
<p >Therefore, if \(I_s\) is the motor rated current, then its maximum torque is produced for \(i_{qs} = I_s\) and \(i_{ds} = 0\) (in fact, \(I_S=\sqrt{i_{qs}^2+i_{ds}^2}\)). In any case, it is clear that, when using an SM-PMSM, the torque/current ratio is optimized by letting \(i_{ds} = 0\). This choice corresponds to the MTPA (maximum-torque-per-ampere) control for isotropic motors.</p>
<p >On the other hand, the magnetic flux can be weakened by acting on the direct axis current \(i_{ds}\); this extends the achievable speed range, but at the cost of a decrease in maximum quadrature current \(i_{qs}\), and hence in the electromagnetic torque supplied to the load (see <a href="DocID18458_4_8_Flux_weakening_control.md#">Flux-weakening control</a> for details about the Flux weakening strategy).</p>
<p >In conclusion, by regulating the motor currents through their components iqs and ids, FOC manages to regulate the PMSM torque and flux. Current regulation is achieved by means of what is usually called a “synchronous frame CR-PWM”.</p>
<p ><a class="el" href="md_docs_pmsm_maximum_torque_per_ampere_control.html">Next: Maximum Torque Per Ampere (MTPA) control</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; 2022, ST Microelectronics &#160;<a href="http://st.com">
<img class="footer" src="ST_logo_footer.png" alt="ST Microelectronics"/>
</a>
</small></address>
</body>
</html>
